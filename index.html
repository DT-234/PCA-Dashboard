<!DOCTYPE html>
<html lang="en" id="html-root">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>PCA instance Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/echarts@6.0.0/dist/echarts.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.0/css/all.min.css">
    <style>
        /* Default dark theme variables */
        :root {
            --primary: hsl(193, 85%, 45%);        /* 更明亮的蓝色 */
            --secondary: hsl(231, 82%, 65%);      /* 更明亮的紫色 */
            --accent: hsl(275, 91%, 45%);         /* 更明亮的紫罗兰色 */
            --success: hsl(135, 75%, 45%);        /* 更饱和的绿色 */
            --warning: hsl(48, 95%, 55%);         /* 更明亮的黄色 */
            --danger: hsl(0, 88%, 65%);           /* 更明亮的红色 */
            --text-primary: hsl(210, 20%, 98%);   /* 更纯净的白色 */
            --text-secondary: hsl(210, 15%, 92%); /* 更柔和的浅灰色 */
            --bg-primary: hsl(240, 10%, 10%);     /* 深蓝灰色背景 */
            --bg-secondary: hsl(240, 8%, 16%);    /* 稍亮的深蓝灰色 */
            --bg-card: hsl(240, 8%, 20%);         /* 卡片背景色 */
            --border-color: hsl(240, 8%, 30%);    /* 边框颜色 */
            --sidebar-bg: hsla(240, 10%, 15%, 0.9); /* 侧边栏背景 */
            --transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.1);
            --shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.5), 0 10px 10px -5px rgba(0, 0, 0, 0.3);
            --shadow-lg: 0 20px 25px -5px rgba(0, 0, 0, 0.5), 0 10px 10px -5px rgba(0, 0, 0, 0.3);
        }

        /* Light theme variables */
        [data-theme="light"] {
            --primary: hsl(231, 82%, 60%);        /* 更深的蓝色 */
            --secondary: hsl(235, 64%, 50%);      /* 更深的紫色 */
            --accent: hsl(195, 85%, 55%);         /* 更柔和的青色 */
            --success: hsl(135, 75%, 40%);        /* 更深的绿色 */
            --warning: hsl(48, 95%, 50%);         /* 更深的黄色 */
            --danger: hsl(0, 88%, 60%);           /* 更深的红色 */
            --text-primary: hsl(240, 10%, 15%);   /* 深灰色文本 */
            --text-secondary: hsl(240, 8%, 30%);  /* 中等灰色文本 */
            --bg-primary: hsl(240, 20%, 97%);     /* 非常浅的蓝灰色背景 */
            --bg-secondary: hsl(240, 15%, 92%);   /* 浅灰色背景 */
            --bg-card: hsl(0, 0%, 100%);          /* 纯白卡片 */
            --border-color: hsl(240, 10%, 85%);   /* 浅灰色边框 */
            --sidebar-bg: hsla(0, 0%, 100%, 0.9); /* 半透明白色侧边栏 */
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
        }

        body {
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            padding: 1rem;
            transition: var(--transition);
            overflow-y: auto; /* Make sure the body can scroll */
        }

        body::before {
            content: '';
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: radial-gradient(circle at 10% 20%, rgba(255, 255, 255, 0.05) 0%, rgba(0, 0, 0, 0) 20%),
                        radial-gradient(circle at 90% 80%, rgba(255, 255, 255, 0.05) 0%, rgba(0, 0, 0, 0) 20%);
            z-index: -1;
            pointer-events: none;
        }

        .theme-toggle {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 1.5rem;
            transition: var(--transition);
            box-shadow: var(--shadow);
            color: var(--text-primary);
        }

        .theme-toggle:hover {
            transform: rotate(15deg) scale(1.1);
            box-shadow: var(--shadow-lg);
        }

        /* --- Ensure Parent Containers are Responsive --- */
        /* These styles might already exist or be slightly different, but ensure they are present */
        /* App container - usually flex */
        .app-container {
            display: flex;
            max-width: 100%;
            min-width: 0; /* Prevent flex container from overflowing and allow flex items to shrink */
            margin: 0 auto;
            gap: 1.5rem;
            height: calc(100vh - 2rem);
            padding-top: var(--sidebar-height, 0); /* For mobile if applicable */
        }

        /* Sidebar - the container holding .nav-tabs */
        .sidebar {
            /* Set a reasonable width */
            width: 280px; /* Or use flex-basis */
            background: var(--sidebar-bg);
            backdrop-filter: blur(12px);
            border-radius: 16px;
            padding: 1.5rem 0;
            box-shadow: var(--shadow);
            display: flex;
            flex-direction: column;
            transition: var(--transition);
            border: 1px solid var(--border-color);
        }
        /* --- End Parent Container Checks --- */

        .logo {
            text-align: center;
            padding: 0 1.5rem 2rem;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 1.5rem;
        }

        .logo h1 {
            font-size: 1.5rem;
            font-weight: 800;
            background: linear-gradient(45deg, var(--danger), var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .nav-tabs {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            padding: 0 1rem;
        }

        /* Hide all tab content by default */
        .tab-content {
            display: none;
        }

        /* Show active tab content */
        .tab-content.active {
            display: block;
        }

        .tab-button {
            /* Use Flexbox for internal alignment */
            display: flex;
            align-items: center; /* Center content vertically */
            gap: 1rem; /* Space between icon and text */
            padding: 1rem 1.5rem; /* Internal padding */
            border: none;
            border-radius: 12px;
            background: transparent;
            color: var(--text-primary);
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .tab-button::before {
            content: '';
            position: absolute;
            top: 0; left: 0;
            width: 4px;
            height: 100%;
            background: var(--primary);
            transform: scaleY(0);
            transition: var(--transition);
        }

        .tab-button:hover {
            background: rgba(76, 201, 240, 0.1);
            transform: translateX(5px);
        }

        .tab-button:hover::before {
            transform: scaleY(1);
        }

        .tab-button.active {
            background: rgba(76, 201, 240, 0.15);
            color: var(--primary);
            font-weight: 600;
        }

        .tab-button.active::before {
            transform: scaleY(1);
        }

        .tab-button i {
            font-size: 1.2rem;
            width: 24px;
            text-align: center;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            min-width: 0; /* Allow flex items to shrink */
            width: 100%; /* Make sure to occupy available space */
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 1.5rem;
            background: var(--bg-card);
            backdrop-filter: blur(12px);
            border-radius: 16px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border-color);
        }

        .header h2 {
            font-size: 1.8rem;
            font-weight: 700;
            background: linear-gradient(45deg, var(--danger), var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .content-area {
            flex: 1;
            background: var(--bg-card);
            backdrop-filter: blur(12px);
            border-radius: 16px;
            padding: 2rem;
            box-shadow: var(--shadow);
            overflow-y: auto; /* Allow scrolling within content area */
            border: 1px solid var(--border-color);
            /* min-height: 0; */ /* Allow the content area to shrink */
        }

        .section-title {
            font-size: 1.5rem;
            font-weight: 700;
            margin: 2rem 0 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--primary);
            display: flex;
            align-items: center;
            gap: 0.75rem;
            color: var(--text-primary);
        }

        .section-title i {
            color: var(--primary);
        }

        /* Cards and Grids */
        .card {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: var(--shadow);
            border: 1px solid var(--border-color);
            margin-bottom: 1.5rem;
            transition: var(--transition);
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        /* --- Graph Styles --- */
        .graphs-section {
            margin-top: 20px;
        }

        .graph-container {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 20px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border-color);
            margin-bottom: 30px;
            /* Ensure canvas inside can resize */
            position: relative;
            height: 400px; /* Set a fixed height for the chart containers */
        }

        /* Make canvas elements responsive and fill their container */
        .graph-container canvas {
            width: 100% !important; /* Force canvas to fill container width */
            height: 100% !important; /* Force canvas to fill container height */
        }
        /* --- End Graph Styles --- */

        .counter-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .counter-item {
            font-weight: bold;
            margin: 8px 0;
            padding: 5px;
            border-radius: 3px;
            display: flex;
            justify-content: space-between;
        }

        .counter-item:hover {
            background-color: rgba(76, 201, 240, 0.1);
        }

        .counter-item span {
            color: var(--primary);
            font-size: 1.1em;
            min-width: 30px;
            text-align: right;
        }

        .total-counter {
            font-size: 1.8rem; /* Larger font size */
            font-weight: bold;
            margin: 20px 0; /* Increased vertical margin */
            padding: 20px; /* Increased padding */
            background: linear-gradient(135deg, var(--danger), var(--accent));
            color: white; /* White text for better contrast */
            border-radius: 12px; /* Slightly larger border radius */
            text-align: center;
            box-shadow: var(--shadow);
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px; /* Space between icon and text */
        }

        /* --- Flexbox Styles for Second Dashboard Panel Group --- */
        .dashboard-flex-container {
            display: flex;
            flex-direction: row; /* Arrange sub-elements horizontally */
            flex-wrap: wrap; /* Allow child elements to wrap if necessary */
            gap: 20px; /* Spacing between sub-elements */
            width: 100%; /* Fill the width of the parent container */
        }

        /* Optional: Fine-tune .counter-section's behavior within the flex container */
        .dashboard-flex-container > .counter-section {
            flex: 1 1 auto; /* Allows growth and shrinkage, base width determined by content */
            min-width: 250px; /* Set a minimum width to prevent over-compression */
            margin: 0; /* Remove possible default margins */
        }
        /* --- End of Flexbox Styles --- */

        /* Search Bar */
        .search-container {
            margin: 1rem 0;
            position: relative;
        }

        .search-bar {
            width: 100%;
            padding: 0.75rem 1rem 0.75rem 2.5rem;
            border-radius: 12px;
            border: 1px solid var(--border-color);
            background: var(--bg-secondary);
            color: var(--text-primary);
            font-size: 1rem;
            transition: var(--transition);
        }

        .search-bar:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(76, 201, 240, 0.3);
        }

        .search-icon {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-secondary);
        }

        .clear-search {
            position: absolute;
            right: 1rem;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 1.2rem;
            display: none;
        }

        .clear-search.show {
            display: block;
        }

        /* Table Styles */
        .table-container {
            width: 100%; /* Take full width of parent */
            max-width: 100%; /* Make sure the table doesn't overflow the container */
            box-sizing: border-box; /* Include padding/border in width calculation */
            overflow-x: auto; /* Horizontal scrolling for wide tables */
            margin: 1rem 0;
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            /* Custom scrollbar styles */
            scrollbar-width: thin;
            scrollbar-color: var(--primary) var(--bg-card);
        }

        /* Webkit browsers scrollbar styles */
        .table-container::-webkit-scrollbar {
            height: 8px;
            width: 8px;
        }

        .table-container::-webkit-scrollbar-track {
            background: var(--bg-card);
            border-radius: 4px;
        }

        .table-container::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 4px;
        }

        .table-container::-webkit-scrollbar-thumb:hover {
            background: var(--secondary);
        }

        table {
            width: 100%;
            min-width: 100%; /* Ensure the table is not forced to expand */
            border-collapse: separate;
            border-spacing: 0;
            background: var(--bg-card);
            color: var(--text-primary);
            table-layout: auto; /* Let columns size based on content */
        }

        th {
            background: linear-gradient(135deg, var(--danger), var(--accent));
            color: white;
            font-weight: 600;
            padding: 1rem;
            text-align: left;
            position: sticky;
            top: 0;
            white-space: nowrap;
            z-index: 10; /* Ensure header stays on top */
        }

        td {
            padding: 1rem;
            border-bottom: 1px solid var(--border-color);
            transition: var(--transition);
            color: var(--text-secondary);
            white-space: nowrap;
        }

        tr:last-child td {
            border-bottom: none;
        }

        tr:hover td {
            background: rgba(76, 201, 240, 0.05);
            transform: scale(1.01);
        }

        /* Hidden class for filtering */
        .hidden {
            display: none;
        }

        a {
            color: var(--primary);
            text-decoration: none;
            font-weight: 500;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        a:hover {
            color: var(--accent);
            text-decoration: underline;
        }

        a i {
            font-size: 0.8rem;
        }

        /* Filter Section */
        .filter-section {
            background-color: var(--bg-secondary);
            padding: 15px;
            margin: 15px 0;
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }

        .filter-section h4 {
            margin-top: 0;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .filter-dropdown {
            padding: 8px 12px;
            margin: 5px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            background: var(--bg-card);
            color: var(--text-primary);
            min-width: 200px;
        }

        .filter-buttons {
            margin: 15px 0;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            align-items: center;
        }

        .filter-btn {
            padding: 8px 12px;
            margin: 5px;
            border: 1px solid var(--border-color);
            background: var(--bg-secondary);
            color: var(--text-primary);
            border-radius: 6px;
            cursor: pointer;
            transition: background 0.2s;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .filter-btn:hover {
            background: var(--hover-bg);
        }

        .filter-btn.active {
            background: var(--primary);
            color: var(--text-primary);
            border-color: var(--primary);
        }

        /* --- Scroll to Bottom and Back to Top Button Styles --- */
        #scrollToBottom {
            display: none; /* Hidden by default, shown by JS */
            position: fixed; /* Fixed/sticky position */
            bottom: 10px; /* Place the button 20px from the bottom */
            /* --- ADJUST RIGHT POSITION FOR CIRCULAR BUTTON --- */
            right: 10px; /* Place the button 10px from the right */
            /* --- End of ADJUSTMENT --- */
            z-index: 1000; /* Make sure it does not overlap */
            border: none; /* Remove borders */
            outline: none; /* Remove outline */
            background-color: var(--primary); /* Set a background color */
            color: white; /* Text color */
            cursor: pointer; /* Add a mouse pointer on hover */
            /* --- CHANGED TO MAKE IT CIRCULAR --- */
            width: 40px; /* Set a fixed width */
            height: 40px; /* Set a fixed height equal to width */
            padding: 0; /* Remove padding to center the icon */
            border-radius: 50%; /* Make it a perfect circle */
            display: flex; /* Use flexbox to center the icon */
            justify-content: center; /* Center horizontally */
            align-items: center; /* Center vertically */
            /* --- End of CHANGES --- */
            font-size: 18px; /* Icon size */
            box-shadow: var(--shadow); /* Add shadow for depth */
            transition: var(--transition); /* Add smooth transition for hover effects */
        }

        #scrollToBottom:hover {
            background-color: var(--secondary); /* Add a dark-grey background on hover */
            /* --- OPTIONAL: Slightly enlarge on hover for circular button --- */
            transform: translateY(5px) scale(1.1); /* Push down and slightly enlarge on hover (note: translateY(5px) for bottom button) */
            box-shadow: var(--shadow-lg); /* Larger shadow on hover */
            /* --- End of OPTIONAL ENLARGE --- */
        }

        #scrollToBottom i { /* Style the Font Awesome icon inside the button */
            pointer-events: none; /* Ensure clicks go to the button, not the icon */
            /* Icon is now centered by flexbox on the button itself */
        }
        /* - End of Scroll to Bottom Button Styles (Circular) - */

        #backToTop {
            display: none; /* Hidden by default */
            position: fixed; /* Fixed/sticky position */
            bottom: 10px; /* Place the button 10px from the bottom */
            right: 60px; /* Place it to the left of #scrollToBottom (accounting for 40px width + 10px gap) */
            z-index: 1000; /* Make sure it does not overlap */
            border: none; /* Remove borders */
            outline: none; /* Remove outline */
            background-color: var(--primary); /* Set a background color */
            color: white; /* Text color */
            cursor: pointer; /* Add a mouse pointer on hover */
            /* --- CHANGED TO MAKE IT CIRCULAR --- */
            width: 40px; /* Set a fixed width */
            height: 40px; /* Set a fixed height equal to width */
            padding: 0; /* Remove padding to center the icon */
            border-radius: 50%; /* Make it a perfect circle */
            display: flex; /* Use flexbox to center the icon */
            justify-content: center; /* Center horizontally */
            align-items: center; /* Center vertically */
            /* --- End of CHANGES --- */
            font-size: 18px; /* Icon size */
            box-shadow: var(--shadow); /* Add shadow for depth */
            transition: var(--transition); /* Add smooth transition for hover effects */
        }

        #backToTop:hover {
            background-color: var(--secondary); /* Add a dark-grey background on hover */
            /* --- OPTIONAL: Slightly enlarge on hover for circular button --- */
            transform: translateY(-5px) scale(1.1); /* Lift and slightly enlarge on hover */
            box-shadow: var(--shadow-lg); /* Larger shadow on hover */
            /* --- End of OPTIONAL ENLARGE --- */
        }

        #backToTop i { /* Style the Font Awesome icon inside the button */
            pointer-events: none; /* Ensure clicks go to the button, not the icon */
            /* Icon is now centered by flexbox on the button itself */
        }
        /* - End of Back to Top Button Styles (Circular) - */
        /* --- End of Scroll to Bottom and Back to Top Button Styles --- */

        /* Toast Notification */
        .toast {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            background: var(--bg-secondary);
            color: var(--text-primary);
            padding: 1rem 1.5rem;
            border-radius: 12px;
            box-shadow: var(--shadow-lg);
            transform: translateY(100px);
            opacity: 0;
            transition: var(--transition);
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            border: 1px solid var(--border-color);
        }

        .toast.show {
            transform: translateY(0);
            opacity: 1;
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .app-container {
                flex-direction: column;
                height: auto;
                padding-top: calc(var(--sidebar-height, 0) + 1rem); /* Ensure padding is correct */
            }

            .sidebar {
                width: 100%;
                flex-direction: row;
                flex-wrap: wrap;
                padding: 1rem;
                height: 4rem; /* Allow height to adjust on small screens */
            }

            .logo {
                padding: 0 1rem;
                border-bottom: none;
                margin-bottom: 0;
                border-right: 1px solid var(--border-color);
                margin-right: 1rem;
            }

            /* --- Navigation Tabs Container --- */
            .nav-tabs {
                flex-direction: row;
                padding: 0;
                flex: 1;
                overflow-x: auto;
            }
            /* --- End Navigation Tabs Container --- */

            /* --- Individual Tab Button --- */
            .tab-button {
                white-space: nowrap; /* Keep text on one line */
                overflow: hidden; /* Needed for text-overflow */
                text-overflow: ellipsis; /* Show ... if text is clipped */
                padding: 0.5rem 1rem;
            }
            /* --- End Individual Tab Button --- */

            .main-content {
                height: auto; /* Allow height to adjust */
                overflow-y: visible; /* Remove overflow scrolling on main content */
            }

            .content-area {
                height: auto; /* Allow height to adjust */
                overflow-y: auto; /* Remove overflow scrolling */
            }

            #scrollToBottom {
                right: 10px;
                bottom: 10px;
                padding: 0;
                font-size: 18px;
            }

            #backToTop {
                right: 60px;
                bottom: 10px;
                padding: 0;
                font-size: 18px;
            }
        }

        @media (max-width: 768px) {
            .dashboard-flex-container {
                flex-direction: column; /* Stack vertically on small screens */
                align-items: stretch; /* Let the child element stretch to fill the container width */
            }

            .dashboard-flex-container > .counter-section {
                min-width: unset; /* Remove minimum width restriction */
            }

            body {
                padding: 0.5rem;
            }

            .header {
                flex-direction: column;
                gap: 1rem;
                text-align: center;
            }

            .content-area {
                height: auto; /* Allow height to adjust */
                overflow-y: auto; /* Remove overflow scrolling */
                padding: 1rem; /* Smaller padding */
            }

            #scrollToBottom {
                right: 10px;
                bottom: 10px;
                padding: 0;
                font-size: 18px;
            }

            #backToTop {
                right: 60px;
                bottom: 10px;
                padding: 0;
                font-size: 18px;
            }

            .section-title {
                font-size: 1.25rem; /* Smaller section title */
            }

            .total-counter {
                font-size: 1.5rem; /* Smaller total counter */
                padding: 15px; /* Smaller padding */
                gap: 10px; /* Smaller gap */
            }

            th, td {
                padding: 0.75rem; /* Smaller cell padding */
                font-size: 0.9rem; /* Smaller font */
            }

            .filter-section {
                padding: 10px; /* Smaller padding */
            }

            .filter-dropdown {
                padding: 6px 10px; /* Smaller padding */
                min-width: 150px; /* Smaller min width */
                font-size: 0.9rem; /* Smaller font */
            }

            .filter-btn {
                padding: 6px 10px; /* Smaller padding */
                font-size: 0.9rem; /* Smaller font */
            }

            .counter-grid {
                grid-template-columns: 1fr; /* Stack cards vertically on mobile */
                gap: 15px; /* Smaller gap */
            }

            .card {
                padding: 1rem; /* Smaller card padding */
            }
        }

        /* --- Export to Excel Bottom Styles --- */
        .export-buttons {
            display: flex;
            gap: 10px;
            margin: 15px 0;
            flex-wrap: wrap;
        }

        .export-btn {
            padding: 10px 16px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: var(--transition);
            font-size: 0.9rem;
        }

        .export-csv {
            background: var(--success);
            color: white;
        }

        .export-excel {
            background: var(--primary);
            color: white;
        }

        .export-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .export-btn:active {
            transform: translateY(0);
        }
        /* --- End of Export to Excel Bottom Styles --- */
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Sidebar Navigation -->
        <div class="sidebar">
            <div class="nav-tabs">
                <button class="tab-button active" data-tab="dashboard">
                    <i class="fas fa-chart-line"></i>
                    Dashboard
                </button>
                <button class="tab-button" data-tab="analytics">
                    <i class="fas fa-database"></i>
                    Analytics
                </button>
                <button class="tab-button" data-tab="instances">
                    <i class="fas fa-chart-column"></i>
                    Instances
                </button>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <div class="header">
                <h2><i class="fas fa-cloud"></i>
                PCA Instance Dashboard</h2>
                <button class="theme-toggle" id="themeToggle">
                    <i class="fas fa-sun"></i>
                </button>
            </div>

            <div class="content-area">
                <!-- Tab 1: Dashboard Tab -->
                <div id="dashboard" class="tab-content active">
                    <div class="dashboard-header">
                        <div class="report-info">
                            <i class="fas fa-clock"></i>
                            Report auto-generated at 2025-11-14 11:30:01 (GMT+8)
                        </div>
                    </div>

                    <div class="total-counter">
                        <i class="fas fa-cube"></i>
                        Total Instances: <span id="dashboard-total-count">0</span>
                    </div>

                    <!-- Graphs Section -->
                    <div class="graphs-section">
                        <!-- Resource Utilization Chart -->
                        <h3 class="section-title"><i class="fas fa-chart-bar"></i> Resource Utilization Overview</h3>
                        <div class="graph-container">
                            <div id="resourceUtilizationChart" style="width: 100%; height: 100%;"></div>
                        </div>

                        <!-- Instance Distribution Chart -->
                        <h3 class="section-title"><i class="fas fa-tachometer-alt"></i> Instance Distribution Overview</h3>
                        <div class="graph-container">
                            <div id="instanceDistributionChart" style="width: 100%; height: 100%;"></div>
                        </div>
                    </div><!-- End of Graphs Section -->
                </div><!-- End of Tab 1: Dashboard Tab -->

                <!-- Tab 2: Analytics Tab -->
                <div id="analytics" class="tab-content">
                    <div class="analytics-header">
                        <div class="report-info">
                            <i class="fas fa-clock"></i>
                            Report auto-generated at 2025-11-14 11:30:01 (GMT+8)
                        </div>
                    </div>

                    <div class="total-counter">
                        <i class="fas fa-cube"></i>
                        Total Instances: <span id="analytics-total-count">0</span>
                    </div>

                    <div class="instance-counters">
                        
                    <!-- Fault Domain Resource Table (Full Width on Top) -->
                    <div style="grid-column: 1 / -1; margin-bottom: 30px;">
                        <div class="card">
                    <h3 class="section-title"><i class="fas fa-bolt"></i> Fault Domain Resources</h3>
                    <div class="counter-item">No instance data found or FD capacity not configured.</div>
                  </div>
                    </div>

                    <!-- Tenancy Resource Summary Table -->
                    <div style="grid-column: 1 / -1; margin-bottom: 30px;">
                        <div class="card">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; flex-wrap: wrap; gap: 10px;">
                                <h3 class="section-title" style="margin: 0;"><i class="fas fa-building"></i> Tenancies Resource Summary</h3>
                                <p style="font-size: 0.9em; color: var(--text-secondary); margin: 0; text-align: right;">(Based on total capacity: 0 OCPUs, 0.00 GB)</p>
                                <div class="export-buttons">
                                    <button class="export-btn export-excel" onclick="exportTenancyToExcel()">
                                        <i class="fas fa-file-excel"></i>
                                        Export to Excel
                                    </button>
                                </div>
                            </div>
                            <div class="table-container">
                            <table id="tenancyResourceTable" class="responsive-table">
                                <thead>
                                    <tr>
                                        <th style="font-size: 1.0em;">Tenancy Name</th>
                                        <th style="font-size: 1.0em;">Instance Count</th>
                                        <th style="font-size: 1.0em;">Allocated OCPUs</th>
                                        <th style="font-size: 1.0em;">Allocated OCPUs %</th>
                                        <th style="font-size: 1.0em;">Allocated Memory (GB)</th>
                                        <th style="font-size: 1.0em;">Allocated Memory %</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td style="font-weight: bold;">AcmeCorpTenancy</td>
                                        <td style="text-align: right;">0</td>
                                        <td style="text-align: right;">0</td>
                                        <td style="text-align: right;">0.0%</td>
                                        <td style="text-align: right;">0.00</td>
                                        <td style="text-align: right;">0.0%</td>
                                    </tr>
                                    <tr>
                                        <td style="font-weight: bold;">BumblebeeTenancy</td>
                                        <td style="text-align: right;">0</td>
                                        <td style="text-align: right;">0</td>
                                        <td style="text-align: right;">0.0%</td>
                                        <td style="text-align: right;">0.00</td>
                                        <td style="text-align: right;">0.0%</td>
                                    </tr>
                                    <tr>
                                        <td style="font-weight: bold;">ClouderaTenancy</td>
                                        <td style="text-align: right;">0</td>
                                        <td style="text-align: right;">0</td>
                                        <td style="text-align: right;">0.0%</td>
                                        <td style="text-align: right;">0.00</td>
                                        <td style="text-align: right;">0.0%</td>
                                    </tr>
                                    <tr>
                                        <td style="font-weight: bold;">DemoTenancy</td>
                                        <td style="text-align: right;">0</td>
                                        <td style="text-align: right;">0</td>
                                        <td style="text-align: right;">0.0%</td>
                                        <td style="text-align: right;">0.00</td>
                                        <td style="text-align: right;">0.0%</td>
                                    </tr>
                                    <tr>
                                        <td style="font-weight: bold;">StarTenancy</td>
                                        <td style="text-align: right;">0</td>
                                        <td style="text-align: right;">0</td>
                                        <td style="text-align: right;">0.0%</td>
                                        <td style="text-align: right;">0.00</td>
                                        <td style="text-align: right;">0.0%</td>
                                    </tr>
                                    <tr>
                                        <td style="font-weight: bold;">temptest</td>
                                        <td style="text-align: right;">0</td>
                                        <td style="text-align: right;">0</td>
                                        <td style="text-align: right;">0.0%</td>
                                        <td style="text-align: right;">0.00</td>
                                        <td style="text-align: right;">0.0%</td>
                                    </tr>
                                    <tr style="background-color: var(--header-bg); font-weight: bold;">
                                        <td>OVERALL TOTALS</td>
                                        <td style="text-align: right;">0</td>
                                        <td style="text-align: right;">0</td>
                                        <td style="text-align: right;">0.0%</td>
                                        <td style="text-align: right;">0.00</td>
                                        <td style="text-align: right;">0.0%</td>
                                    </tr>
                                </tbody>
                            </table>
                            </div>
                        </div>

                    </div>

                    <div class="instance-counters">
                        
                        <div class="dashboard-flex-container">
                            <div class="card"><h3 class="section-title"><i class="fas fa-bolt"></i> Fault Domains</h3><div class="counter-item">No data available</div></div>
                            <div class="card"><h3 class="section-title"><i class="fas fa-building"></i> Tenancies</h3><div class="counter-item">AcmeCorpTenancy: <span id="tenancy-acmecorptenancy-count">0</span></div><div class="counter-item">BumblebeeTenancy: <span id="tenancy-bumblebeetenancy-count">0</span></div><div class="counter-item">ClouderaTenancy: <span id="tenancy-clouderatenancy-count">0</span></div><div class="counter-item">DemoTenancy: <span id="tenancy-demotenancy-count">0</span></div><div class="counter-item">StarTenancy: <span id="tenancy-startenancy-count">0</span></div><div class="counter-item">temptest: <span id="tenancy-temptest-count">0</span></div></div>
                            <div class="card"><h3 class="section-title"><i class="fas fa-chart-column"></i> Instance States</h3><div class="counter-item">No data available</div></div>
                            <div class="card"><h3 class="section-title"><i class="fas fa-folder"></i> Compartments</h3><div class="counter-item">[AcmeCorpTenancy] ROOT: <span id="compartment-_acmecorptenancy__root-count">0</span></div><div class="counter-item">[BumblebeeTenancy] ROOT: <span id="compartment-_bumblebeetenancy__root-count">0</span></div><div class="counter-item">[ClouderaTenancy] ROOT: <span id="compartment-_clouderatenancy__root-count">0</span></div><div class="counter-item">[DemoTenancy] ROOT: <span id="compartment-_demotenancy__root-count">0</span></div><div class="counter-item">[StarTenancy] ROOT: <span id="compartment-_startenancy__root-count">0</span></div><div class="counter-item">[temptest] ROOT: <span id="compartment-_temptest__root-count">0</span></div></div>
                        </div>

                    </div>
                </div>
                </div><!-- End of Tab 2: Analytics Tab -->

                <!-- Tab 3: Instances Tab -->
                <div id="instances" class="tab-content">
                    <div class="instances-header">
                        <div class="report-info">
                            <i class="fas fa-clock"></i>
                            Report auto-generated at 2025-11-14 11:30:01 (GMT+8)
                        </div>
                    </div>

                    <div class="total-counter">
                        <i class="fas fa-cube"></i>
                        Total Instances: <span id="tab2-total-count">0</span> |
                            Visible: <span id="tab2-visible-count" style="color: var(--primary); font-weight: bold;">0</span>
                    </div>

                    <!-- Filter Section -->
                    <div class="filter-section">
                        <h4><i class="fas fa-filter"></i> Filters</h4>

                        <!-- State Filter Buttons -->
                        <div class="filter-buttons">
                            <strong>Instance State:</strong>
                            <button class="filter-btn active" onclick="filterTab2Instances('ALL', 'state')" data-filter-type="state"><i class="fas fa-list"></i> Show All</button>
                            <button class="filter-btn" onclick="filterTab2Instances('RUNNING', 'state')" data-filter-type="state"><i class="fas fa-play-circle"></i> Running</button>
                            <button class="filter-btn" onclick="filterTab2Instances('STARTING', 'state')" data-filter-type="state"><i class="fas fa-hourglass-start"></i> Starting</button>
                            <button class="filter-btn" onclick="filterTab2Instances('STOPPED', 'state')" data-filter-type="state"><i class="fas fa-stop-circle"></i> Stopped</button>
                            <button class="filter-btn" onclick="filterTab2Instances('TERMINATED', 'state')" data-filter-type="state"><i class="fas fa-trash-alt"></i> Terminated</button>
                        </div>

                        <!-- Advanced Dropdown Filters -->
                        <div style="margin: 15px 0;">
                            <strong>Advanced Filters:</strong>
                            
                            <select id="tab2-tenancy-filter" class="filter-dropdown" onchange="applyTab2Filters()">
                                <option value="ALL">All Tenancies</option>
                                
                            </select>
    
                            <select id="tab2-compartment-filter" class="filter-dropdown" onchange="applyTab2Filters()">
                                <option value="ALL">All Compartments</option>
                                <optgroup label="AcmeCorpTenancy">
                                    <option value="ROOT" data-tenancy="AcmeCorpTenancy">ROOT</option>
                                </optgroup>
                                <optgroup label="BumblebeeTenancy">
                                    <option value="ROOT" data-tenancy="BumblebeeTenancy">ROOT</option>
                                </optgroup>
                                <optgroup label="ClouderaTenancy">
                                    <option value="ROOT" data-tenancy="ClouderaTenancy">ROOT</option>
                                </optgroup>
                                <optgroup label="DemoTenancy">
                                    <option value="ROOT" data-tenancy="DemoTenancy">ROOT</option>
                                </optgroup>
                                <optgroup label="StarTenancy">
                                    <option value="ROOT" data-tenancy="StarTenancy">ROOT</option>
                                </optgroup>
                                <optgroup label="temptest">
                                    <option value="ROOT" data-tenancy="temptest">ROOT</option>
                                </optgroup>
                            </select>
                            <select id="tab2-fault-domain-filter" class="filter-dropdown" onchange="applyTab2Filters()">
                                <option value="ALL">All Fault Domains</option>
                            </select>
                            <button onclick="resetTab2Filters()" style="padding: 8px 12px; margin: 5px; background: var(--danger); color: white; border: none; border-radius: 6px; cursor: pointer; display: inline-flex; align-items: center; gap: 0.5rem;"><i class="fas fa-redo"></i> Reset All Filters</button>
                            <button onclick="exportInstancesToExcel()" style="padding: 8px 12px; margin: 5px; background: var(--success); color: white; border: none; border-radius: 6px; cursor: pointer; display: inline-flex; align-items: center; gap: 0.5rem;"><i class="fas fa-file-excel"></i> Export to Excel</button>
                        </div>
                    </div>

                    <!-- Search Bar -->
                    <div class="search-container">
                        <i class="fas fa-search search-icon"></i>
                        <input type="text" id="tab2-search" class="search-bar" placeholder="Search any field..." />
                        <button class="clear-search" id="clear-instances"><i class="fas fa-times"></i></button>
                    </div>

                    <!-- Instance Table -->
                    <div class="table-container">
                        <table id="instanceTable">
                            <thead><tr><th>Tenancy</th><th>Compartment</th><th>Name</th><th>State</th><th>OCPUs</th><th>Memory (GB)</th><th>AD</th><th>Fault Domains</th><th>MAC Address</th><th>Private IP</th><th>Public IP</th><th>Recovery</th><th>Created</th><th>Shape</th><th>Compartment ID</th><th>Instance ID</th></tr></thead>
                            <tbody>
                            </tbody>
                        </table>
                    </div>
                </div><!-- End of Tab 3: Instances Tab -->
            </div><!-- End of content-area -->
        </div><!-- End of main-content -->
    </div><!-- End of app-container -->

    <!-- Back to Top Button (MOVED INSIDE content-area) -->
    <button id="backToTop" title="Go to top"><i class="fas fa-arrow-up"></i></button>
    <!-- End of Back to Top Button -->

    <!-- Scroll to Bottom Button (ADDED INSIDE content-area) -->
    <button id="scrollToBottom" title="Go to bottom"><i class="fas fa-arrow-down"></i></button>
    <!-- End of Scroll to Bottom Button -->

    <!-- Toast Notification -->
    <div class="toast" id="toast">
        <i class="fas fa-check-circle"></i>
        <span id="toast-text">Filter applied!</span>
    </div>

    <script>
        // 在页面加载时滚动到顶部
        window.addEventListener('load', function() {
            // 立即滚动到顶部
            window.scrollTo(0, 0);

            // 添加一个小的延迟确保DOM完全加载
            setTimeout(function() {
                window.scrollTo(0, 0);
            }, 100);
        });

        // 如果页面是从缓存加载的，也确保滚动到顶部
        window.addEventListener('pageshow', function(event) {
            if (event.persisted) {
                window.scrollTo(0, 0);
            }
        });

        // --- Export To Excel Logic ---
        function exportToCSV() {
            try {
                const table = document.getElementById('instanceTable');
                const rows = table.querySelectorAll('tr');
                let csvContent = "";

                // 获取表头
                const headerCells = rows[0].querySelectorAll('th');
                const headerRow = Array.from(headerCells).map(cell => {
                    // 处理包含特殊字符的文本
                    let text = cell.textContent.trim();
                    // 如果包含逗号、引号或换行符，用引号包围并转义内部引号
                    if (text.includes(',') || text.includes('"') || text.includes('\n')) {
                        text = '"' + text.replace(/"/g, '""') + '"';
                    }
                    return text;
                }).join(',');
                csvContent += headerRow + '\n';

                // 获取数据行（只导出可见的行）
                for (let i = 1; i < rows.length; i++) {
                    const row = rows[i];
                    // 跳过隐藏的行
                    if (row.classList.contains('hidden')) continue;

                    const cells = row.querySelectorAll('td');
                    const rowData = Array.from(cells).map(cell => {
                        let text = cell.textContent.trim();
                        // 处理包含特殊字符的文本
                        if (text.includes(',') || text.includes('"') || text.includes('\n')) {
                            text = '"' + text.replace(/"/g, '""') + '"';
                        }
                        return text;
                    }).join(',');
                    csvContent += rowData + '\n';
                }

                // 创建下载链接
                const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                const url = URL.createObjectURL(blob);
                link.setAttribute('href', url);
                link.setAttribute('download', `pca_instances_${getFormattedTimestamp()}.csv`);
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);

                showToast('CSV文件导出成功！');
            } catch (error) {
                console.error('导出CSV时出错:', error);
                showToast('导出CSV时出错，请重试');
            }
        }

        function exportToExcel() {
            try {
                const table = document.getElementById('instanceTable');
                const workbook = XLSX.utils.book_new();

                // 准备数据
                const data = [];
                const rows = table.querySelectorAll('tr');

                // 处理表头
                const headerCells = rows[0].querySelectorAll('th');
                const headerRow = Array.from(headerCells).map(cell => cell.textContent.trim());
                data.push(headerRow);

                // 处理数据行（只导出可见的行）
                for (let i = 1; i < rows.length; i++) {
                    const row = rows[i];
                    // 跳过隐藏的行
                    if (row.classList.contains('hidden')) continue;

                    const cells = row.querySelectorAll('td');
                    const rowData = Array.from(cells).map(cell => cell.textContent.trim());
                    data.push(rowData);
                }

                // 创建工作表
                const worksheet = XLSX.utils.aoa_to_sheet(data);

                // 设置列宽（自动调整）
                const colWidths = [];
                for (let i = 0; i < headerRow.length; i++) {
                    let maxLength = headerRow[i].length;
                    for (let j = 1; j < data.length; j++) {
                        if (data[j][i] && data[j][i].length > maxLength) {
                            maxLength = data[j][i].length;
                        }
                    }
                    colWidths.push({ wch: Math.min(maxLength + 2, 50) }); // 限制最大宽度
                }
                worksheet['!cols'] = colWidths;

                // 添加工作表到工作簿
                XLSX.utils.book_append_sheet(workbook, worksheet, 'PCA Instances');

                // 导出文件
                XLSX.writeFile(workbook, `pca_instances_${getFormattedTimestamp()}.xlsx`);

                showToast('Excel文件导出成功！');
            } catch (error) {
                console.error('导出Excel时出错:', error);
                showToast('导出Excel时出错，请重试');
            }
        }

        // 辅助函数：获取格式化的时间戳
        function getFormattedTimestamp() {
            const now = new Date();
            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const day = String(now.getDate()).padStart(2, '0');
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            return `${year}${month}${day}_${hours}${minutes}`;
        }
        // --- End of Export To Excel Logic ---

        // --- Toast Notification ---
        function showToast(message) {
            const toast = document.getElementById('toast');
            const toastText = document.getElementById('toast-text');
            if (toast && toastText) {
                toastText.textContent = message;
                toast.classList.add('show');
                setTimeout(() => {
                    toast.classList.remove('show');
                }, 3000);
            }
        }

        // --- Tab 2 Export To Excel Logic ---
        function exportFaultDomainToCSV() {
            exportTableToCSV('faultDomainTable', 'fault_domain_resources');
        }

        function exportFaultDomainToExcel() {
            exportTableToExcel('faultDomainTable', 'fault_domain_resources');
        }

        function exportTenancyToCSV() {
            exportTableToCSV('tenancyResourceTable', 'tenancy_resources');
        }

        function exportTenancyToExcel() {
            exportTableToExcel('tenancyResourceTable', 'tenancy_resources');
        }

        // 通用的表格导出函数 - 修正版本
        function exportTableToCSV(tableId, filenamePrefix) {
            try {
                const table = document.getElementById(tableId);
                if (!table) {
                    showToast(`未找到表格: ${tableId}`);
                    return;
                }

                const rows = table.querySelectorAll('tr');
                let csvContent = "";

                // 获取表头
                const headerCells = rows[0].querySelectorAll('th');
                const headerRow = Array.from(headerCells).map(cell => {
                    let text = cell.textContent.trim();
                    if (text.includes(',') || text.includes('"') || text.includes('\n')) {
                        text = '"' + text.replace(/"/g, '""') + '"';
                    }
                    return text;
                }).join(',');
                csvContent += headerRow + '\n';

                // 获取数据行
                for (let i = 1; i < rows.length; i++) {
                    const cells = rows[i].querySelectorAll('td, th');
                    const rowData = Array.from(cells).map(cell => {
                        let text = cell.textContent.trim();
                        if (text.includes(',') || text.includes('"') || text.includes('\n')) {
                            text = '"' + text.replace(/"/g, '""') + '"';
                        }
                        return text;
                    }).join(',');
                    csvContent += rowData + '\n';
                }

                // 创建下载链接
                const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                const url = URL.createObjectURL(blob);
                link.setAttribute('href', url);
                link.setAttribute('download', `${filenamePrefix}_${getFormattedTimestamp()}.csv`);
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);

                showToast('CSV文件导出成功！');
            } catch (error) {
                console.error('导出CSV时出错:', error);
                showToast('导出CSV时出错，请重试');
            }
        }

        function exportTableToExcel(tableId, filenamePrefix) {
            try {
                const table = document.getElementById(tableId);
                if (!table) {
                    showToast(`未找到表格: ${tableId}`);
                    return;
                }

                const workbook = XLSX.utils.book_new();
                const data = [];
                const rows = table.querySelectorAll('tr');

                // 处理表头
                const headerCells = rows[0].querySelectorAll('th');
                const headerRow = Array.from(headerCells).map(cell => cell.textContent.trim());
                data.push(headerRow);

                // 处理数据行
                for (let i = 1; i < rows.length; i++) {
                    const cells = rows[i].querySelectorAll('td, th');
                    const rowData = Array.from(cells).map(cell => cell.textContent.trim());
                    data.push(rowData);
                }

                // 创建工作表
                const worksheet = XLSX.utils.aoa_to_sheet(data);

                // 设置列宽
                const colWidths = [];
                for (let i = 0; i < headerRow.length; i++) {
                    let maxLength = headerRow[i].length;
                    for (let j = 1; j < data.length; j++) {
                        if (data[j][i] && data[j][i].length > maxLength) {
                            maxLength = data[j][i].length;
                        }
                    }
                    colWidths.push({ wch: Math.min(maxLength + 2, 50) });
                }
                worksheet['!cols'] = colWidths;

                // 添加工作表到工作簿
                XLSX.utils.book_append_sheet(workbook, worksheet, filenamePrefix);

                // 导出文件
                XLSX.writeFile(workbook, `${filenamePrefix}_${getFormattedTimestamp()}.xlsx`);

                showToast('Excel文件导出成功！');
            } catch (error) {
                console.error('导出Excel时出错:', error);
                showToast('导出Excel时出错，请重试');
            }
        }
        // --- End of Tab 2 Export To Excel Logic ---

        // --- Tab 3 Export To Excel Logic ---
        function exportInstancesToExcel() {
            try {
                const table = document.getElementById('instanceTable');
                if (!table) {
                    showToast('未找到实例表格数据');
                    return;
                }

                const workbook = XLSX.utils.book_new();
                const data = [];
                const rows = table.querySelectorAll('tr');

                // 处理表头
                const headerCells = rows[0].querySelectorAll('th');
                const headerRow = Array.from(headerCells).map(cell => cell.textContent.trim());
                data.push(headerRow);

                // 处理数据行（只导出可见的行）
                for (let i = 1; i < rows.length; i++) {
                    const row = rows[i];
                    // 跳过隐藏的行
                    if (row.classList.contains('hidden')) continue;

                    const cells = row.querySelectorAll('td');
                    const rowData = Array.from(cells).map(cell => cell.textContent.trim());
                    data.push(rowData);
                }

                // 创建工作表
                const worksheet = XLSX.utils.aoa_to_sheet(data);

                // 设置列宽
                const colWidths = [];
                for (let i = 0; i < headerRow.length; i++) {
                    let maxLength = headerRow[i].length;
                    for (let j = 1; j < data.length; j++) {
                        if (data[j][i] && data[j][i].length > maxLength) {
                            maxLength = data[j][i].length;
                        }
                    }
                    colWidths.push({ wch: Math.min(maxLength + 2, 50) });
                }
                worksheet['!cols'] = colWidths;

                // 添加工作表到工作簿
                XLSX.utils.book_append_sheet(workbook, worksheet, 'PCA Instances');

                // 导出文件
                XLSX.writeFile(workbook, `pca_instances_${getFormattedTimestamp()}.xlsx`);

                showToast('实例数据Excel文件导出成功！');
            } catch (error) {
                console.error('导出实例Excel时出错:', error);
                showToast('导出实例Excel时出错，请重试');
            }
        }
        // --- End of Tab 3 Export To Excel Logic ---

        // --- Back to Top Button Logic ---
        let backToTopButton = document.getElementById("backToTop");

        // 检测滚动并显示/隐藏按钮
        function scrollFunction() {
            if (document.body.scrollTop > 100 || document.documentElement.scrollTop > 100) {
                backToTopButton.style.display = "block";
            } else {
                backToTopButton.style.display = "none";
            }
        }

        // 点击按钮回到顶部
        backToTopButton.onclick = function() {
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        }

        document.addEventListener('DOMContentLoaded', function() {
          const contentArea = document.querySelector('.content-area');
          const backToTopButton = document.getElementById('backToTop');
          const scrollToBottomButton = document.getElementById('scrollToBottom');

          if (!contentArea) return;

          function scrollFunction() {
            const { scrollTop, scrollHeight, clientHeight } = contentArea;
            backToTopButton.style.display = scrollTop > 100 ? 'flex' : 'none';
            scrollToBottomButton.style.display =
              (scrollTop + clientHeight < scrollHeight - 100) ? 'flex' : 'none';
          }

          // ✅ 改为监听 content-area 滚动事件
          contentArea.addEventListener('scroll', scrollFunction);

          // ✅ 延迟初始化（等待 dashboard 图表加载完毕）
          setTimeout(scrollFunction, 300);

          // ✅ 当内容高度变化（如图表加载）时自动重新计算
          const observer = new ResizeObserver(scrollFunction);
          observer.observe(contentArea);

          // ✅ 按钮点击行为
          backToTopButton.onclick = () => contentArea.scrollTo({ top: 0, behavior: 'smooth' });
          scrollToBottomButton.onclick = () => contentArea.scrollTo({ top: contentArea.scrollHeight, behavior: 'smooth' });
        });
        // --- End of Back to Top Button Logic ---

        // --- Scroll to Bottom Button Logic ---
        let scrollToBottomButton = document.getElementById("scrollToBottom");

        // Use scroll event on window to detect scrolling and show/hide the button
        // Show the button when the user is not at the very bottom of the page
        window.addEventListener('scroll', function() {
            // Get the total height of the document
            const documentHeight = Math.max(
                document.body.scrollHeight, document.documentElement.scrollHeight,
                document.body.offsetHeight, document.documentElement.offsetHeight,
                document.body.clientHeight, document.documentElement.clientHeight
            );
            // Get the current vertical scroll position
            const scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop || 0;
            // Get the height of the browser window viewport
            const windowHeight = window.innerHeight || document.documentElement.clientHeight || document.body.clientHeight;
            // Calculate how far from the bottom the user is
            const distanceFromBottom = documentHeight - (scrollTop + windowHeight);

            // Show the button if the user is not at the very bottom (with a small tolerance)
            if (distanceFromBottom > 10) { // 10px tolerance
                scrollToBottomButton.style.display = "block";
            } else {
                scrollToBottomButton.style.display = "none";
            }
        });

        // When the user clicks on the button, scroll to the bottom of the DOCUMENT smoothly
        scrollToBottomButton.addEventListener('click', function() {
            window.scrollTo({
                // Scroll to the maximum possible vertical position
                top: document.body.scrollHeight || document.documentElement.scrollHeight,
                behavior: 'smooth'
            });
        });

        // Optional: Hide the button initially on page load if already at the bottom
        document.addEventListener('DOMContentLoaded', function() {
            // Trigger scroll event once to set initial state
            window.dispatchEvent(new Event('scroll'));
        });
        // --- End of Scroll to Bottom Button Logic ---

        // Store tenancy-compartment and tenancy-fault-domain mapping for dynamic filtering
        const tenancyCompartments = {"AcmeCorpTenancy": ["ROOT"], "BumblebeeTenancy": ["ROOT"], "ClouderaTenancy": ["ROOT"], "DemoTenancy": ["ROOT"], "StarTenancy": ["ROOT"], "temptest": ["ROOT"]};
        const tenancyFaultDomains = {"AcmeCorpTenancy": [], "BumblebeeTenancy": [], "ClouderaTenancy": [], "DemoTenancy": [], "StarTenancy": [], "temptest": []};

        // --- Add variables for OCPU/Memory stats if needed for graphs ---
        const ocpuMemoryStats = {"total_capacity_ocpus": 0, "total_capacity_memory_gb": 0.0, "total_allocated_ocpus": 0, "total_allocated_memory_gb": 0.0, "total_free_ocpus": 0, "total_free_memory_gb": 0.0, "fd_capacity_ocpus": 368, "fd_capacity_memory_gb": 2176.0, "fault_domain_allocated_ocpus": {}, "fault_domain_allocated_memory": {}, "fault_domain_free_ocpus": {}, "fault_domain_free_memory": {}, "number_of_fault_domains": 0};
        const attributeCounts = {"states": {}, "tenancies": {"AcmeCorpTenancy": 0, "BumblebeeTenancy": 0, "ClouderaTenancy": 0, "DemoTenancy": 0, "StarTenancy": 0, "temptest": 0}, "compartments": {"[AcmeCorpTenancy] ROOT": 0, "[BumblebeeTenancy] ROOT": 0, "[ClouderaTenancy] ROOT": 0, "[DemoTenancy] ROOT": 0, "[StarTenancy] ROOT": 0, "[temptest] ROOT": 0}, "fault_domains": {}, "tenancy_compartments": {"AcmeCorpTenancy": ["ROOT"], "BumblebeeTenancy": ["ROOT"], "ClouderaTenancy": ["ROOT"], "DemoTenancy": ["ROOT"], "StarTenancy": ["ROOT"], "temptest": ["ROOT"]}, "tenancy_fault_domains": {"AcmeCorpTenancy": [], "BumblebeeTenancy": [], "ClouderaTenancy": [], "DemoTenancy": [], "StarTenancy": [], "temptest": []}, "ocpu_memory_stats": {"total_capacity_ocpus": 0, "total_capacity_memory_gb": 0.0, "total_allocated_ocpus": 0, "total_allocated_memory_gb": 0.0, "total_free_ocpus": 0, "total_free_memory_gb": 0.0, "fd_capacity_ocpus": 368, "fd_capacity_memory_gb": 2176.0, "fault_domain_allocated_ocpus": {}, "fault_domain_allocated_memory": {}, "fault_domain_free_ocpus": {}, "fault_domain_free_memory": {}, "number_of_fault_domains": 0}, "total_instances": 0};
        // --- End of variable declarations ---

        // --- ADD/REPLACE these lines to use the SANITIZED data ---
        // Data prepared in Python for the graphs
        // Use the pre-prepared labels array to ensure consistency
        const tenancyLabelsForGraph = ["AcmeCorpTenancy", "BumblebeeTenancy", "ClouderaTenancy", "DemoTenancy", "StarTenancy", "temptest"];
        // Build the data array by looking up counts for each label
        // This method is robust against missing counts or extra keys like 'total' in attributeCounts.tenancies
        const tenancyDataForGraph = tenancyLabelsForGraph.map(label => (attributeCounts.tenancies || {})[label] || 0);
        const resourceUtilData = {
            totalCapacityOcpus: 0,
            totalAllocatedOcpus: 0,
            totalFreeOcpus: 0,
            totalCapacityMemoryGb: 0.0,
            totalAllocatedMemoryGb: 0.0,
            totalFreeMemoryGb: 0.0
        };
        const instanceDistributionData = {"name": "Resources", "children": [{"name": "AcmeCorpTenancy", "allocated_ocpus": 0, "allocated_ocpus_percentage": 0.0, "allocated_memory": 0.0, "allocated_memory_percentage": 0.0, "children": [{"name": "Allocated OCPUs", "value": 0, "percentage": 0.0, "tenancy": "AcmeCorpTenancy", "itemStyle": {"color": "#91cc75"}}, {"name": "Allocated Memory (GB)", "value": 0.0, "percentage": 0.0, "tenancy": "AcmeCorpTenancy", "itemStyle": {"color": "#fac858"}}]}, {"name": "BumblebeeTenancy", "allocated_ocpus": 0, "allocated_ocpus_percentage": 0.0, "allocated_memory": 0.0, "allocated_memory_percentage": 0.0, "children": [{"name": "Allocated OCPUs", "value": 0, "percentage": 0.0, "tenancy": "BumblebeeTenancy", "itemStyle": {"color": "#91cc75"}}, {"name": "Allocated Memory (GB)", "value": 0.0, "percentage": 0.0, "tenancy": "BumblebeeTenancy", "itemStyle": {"color": "#fac858"}}]}, {"name": "ClouderaTenancy", "allocated_ocpus": 0, "allocated_ocpus_percentage": 0.0, "allocated_memory": 0.0, "allocated_memory_percentage": 0.0, "children": [{"name": "Allocated OCPUs", "value": 0, "percentage": 0.0, "tenancy": "ClouderaTenancy", "itemStyle": {"color": "#91cc75"}}, {"name": "Allocated Memory (GB)", "value": 0.0, "percentage": 0.0, "tenancy": "ClouderaTenancy", "itemStyle": {"color": "#fac858"}}]}, {"name": "DemoTenancy", "allocated_ocpus": 0, "allocated_ocpus_percentage": 0.0, "allocated_memory": 0.0, "allocated_memory_percentage": 0.0, "children": [{"name": "Allocated OCPUs", "value": 0, "percentage": 0.0, "tenancy": "DemoTenancy", "itemStyle": {"color": "#91cc75"}}, {"name": "Allocated Memory (GB)", "value": 0.0, "percentage": 0.0, "tenancy": "DemoTenancy", "itemStyle": {"color": "#fac858"}}]}, {"name": "StarTenancy", "allocated_ocpus": 0, "allocated_ocpus_percentage": 0.0, "allocated_memory": 0.0, "allocated_memory_percentage": 0.0, "children": [{"name": "Allocated OCPUs", "value": 0, "percentage": 0.0, "tenancy": "StarTenancy", "itemStyle": {"color": "#91cc75"}}, {"name": "Allocated Memory (GB)", "value": 0.0, "percentage": 0.0, "tenancy": "StarTenancy", "itemStyle": {"color": "#fac858"}}]}, {"name": "temptest", "allocated_ocpus": 0, "allocated_ocpus_percentage": 0.0, "allocated_memory": 0.0, "allocated_memory_percentage": 0.0, "children": [{"name": "Allocated OCPUs", "value": 0, "percentage": 0.0, "tenancy": "temptest", "itemStyle": {"color": "#91cc75"}}, {"name": "Allocated Memory (GB)", "value": 0.0, "percentage": 0.0, "tenancy": "temptest", "itemStyle": {"color": "#fac858"}}]}]};
        // --- End of adding sanitized data ---

        // --- Define Color Scheme ---
        const colorScheme = {
            // 资源利用图颜色 (保持不变)
            resourceRoot: 'hsl(150, 70%, 60%)',
            resourceOcpus: 'hsl(190, 70%, 60%)',
            resourceMemory: 'hsl(30, 85%, 60%)',
            allocatedOcpus: 'hsl(220, 70%, 60%)',
            freeOcpus: 'hsl(150, 70%, 60%)',
            allocatedMemory: 'hsl(0, 70%, 65%)',
            freeMemory: 'hsl(190, 70%, 65%)',

            // 实例分布图颜色 - 新的丰富配色方案
            tenancyColors: [
                'hsl(340, 85%, 65%)', /* 粉红色 */
                'hsl(270, 60%, 65%)', /* 紫色 */
                'hsl(200, 85%, 65%)', /* 蓝色 */
                'hsl(120, 60%, 65%)', /* 绿色 */
                'hsl(30, 85%, 65%)',  /* 橙色 */
                'hsl(280, 60%, 65%)', /* 紫罗兰色 */
                'hsl(180, 70%, 65%)', /* 青蓝色 */
                'hsl(65, 70%, 65%)',  /* 柠檬黄色 */
                'hsl(230, 60%, 65%)', /* 靛蓝色 */
                'hsl(20, 85%, 65%)',  /* 珊瑚色 */
                'hsl(90, 60%, 65%)',  /* 浅绿色 */
                'hsl(20, 30%, 65%)'   /* 棕色 */
            ],
            ocpusColor: 'hsl(220, 70%, 60%)',
            memoryColor: 'hsl(0, 70%, 65%)'
        };
        // --- End of Define Color Scheme ---

        // --- Track if graphs have been initialized to prevent re-creation ---
        let dashboardGraphsInitialized = false;

        // Global variables to track current filters for Tab 2
        let tab2Filters = {
            state: 'ALL',
            tenancy: 'ALL',
            compartment: 'ALL',
            faultDomain: 'ALL',
            search: ''
        };

        // --- Tab Switching Logic ---
        document.querySelectorAll('.tab-button').forEach(btn => {
          btn.addEventListener('click', () => {
            // 更新 tab 按钮激活状态
            document.querySelectorAll('.tab-button').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');

            // 切换显示 tab 内容
            const targetTab = btn.dataset.tab;
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            const targetContent = document.getElementById(targetTab);
            if (targetContent) {
              targetContent.classList.add('active');

              // ✅ Dashboard 初始化（保持原逻辑）
              if (targetTab === 'dashboard' && !dashboardGraphsInitialized) {
                console.log("[JS] Initializing Dashboard graphs...");
                initializeDashboardGraphs();
                dashboardGraphsInitialized = true;
              }
            } else {
              console.warn(`[JS] Tab content with ID '${targetTab}' not found.`);
            }

            // ✅ 切换 tab 时滚动回顶部
            const contentArea = document.querySelector('.content-area');
            if (contentArea) contentArea.scrollTo({ top: 0 });

            // ✅ 重新绑定滚动按钮监听
            setupScrollButtons();
          });
        });
        // --- End of Tab Switching ---

        // --- Function to Initialize and Render Graphs on the Dashboard Tab using ECharts ---
        function initializeDashboardGraphs() {
            try {
                console.log("[JS] [ECharts] Starting Dashboard graph initialization...");

                // --- 1. Get Chart Containers ---
                // Ensure the container divs exist in your HTML
                const resourceChartContainer = document.getElementById('resourceUtilizationChart');
                const instanceChartContainer = document.getElementById('instanceDistributionChart');

                if (!resourceChartContainer || !instanceChartContainer) {
                    console.error("[JS] [ECharts] Failed to get chart containers (div elements).");
                    return;
                }
                // --- End of 1. Get Chart Containers ---

                // --- 2. Initialize ECharts Instances ---
                const resourceChart = echarts.init(resourceChartContainer);
                const instanceChart = echarts.init(instanceChartContainer);
                // --- End of 2. Initialize ECharts Instances ---

                // --- 3. Prepare Data (Assuming data is available from Python script) ---
                // Use the pre-prepared labels and data arrays from Python
                // These should be available as global JS variables injected by the Python script
                const barLabels = ["AcmeCorpTenancy", "BumblebeeTenancy", "ClouderaTenancy", "DemoTenancy", "StarTenancy", "temptest"]; // Array of strings
                const barData = [0, 0, 0, 0, 0, 0]; // Array of numbers

                // Prepare data for Resource Utilization Doughnut Chart
                const totalCapacityOcpus = ocpuMemoryStats.total_capacity_ocpus || 0;
                const totalAllocatedOcpus = ocpuMemoryStats.total_allocated_ocpus || 0;
                const totalFreeOcpus = ocpuMemoryStats.total_free_ocpus || 0;
                const totalCapacityMemoryGb = ocpuMemoryStats.total_capacity_memory_gb || 0.0;
                const totalAllocatedMemoryGb = ocpuMemoryStats.total_allocated_memory_gb || 0.0;
                const totalFreeMemoryGb = ocpuMemoryStats.total_free_memory_gb || 0.0;

                const doughnutDataArray = [
                    { value: totalAllocatedOcpus, name: 'Allocated OCPUs' },
                    { value: totalFreeOcpus, name: 'Free OCPUs' },
                    { value: totalAllocatedMemoryGb, name: 'Allocated Memory (GB)' },
                    { value: totalFreeMemoryGb, name: 'Free Memory (GB)' }
                ];
                // --- End of 3. Prepare Data (Assuming data is available from Python script) ---

                // --- 4. Configure Resource Utilization Doughnut Chart (using ECharts) ---
                const resourceOption = {
                    // title: {
                    //     text: 'Resource Utilization',
                    //     left: 'center',
                    //     textStyle: {
                    //         fontSize: 16,
                    //         fontWeight: 'bold'
                    //     }
                    // },
                    tooltip: {
                        trigger: 'item',
                        formatter: function (params) {
                            if (params.name === 'Resources') {
                                return `
                                    <b>${params.name}</b><br/>
                                    OCPUs: ${totalCapacityOcpus} OCPUs<br/>
                                    Memory: ${totalCapacityMemoryGb} GB
                                `;
                            }

                            let value = params.value;
                            let percent = '';
                            let unit = '';

                            if (params.name.includes('OCPUs')) {
                                unit = 'OCPUs';
                                if (params.name.includes('Allocated')) {
                                    percent = ((totalAllocatedOcpus / totalCapacityOcpus) * 100).toFixed(1);
                                } else if (params.name.includes('Free OCPUs')) {
                                    percent = ((totalFreeOcpus / totalCapacityOcpus) * 100).toFixed(1);
                                }
                            }
                            else if (params.name.includes('Memory')) {
                                unit = 'GB';
                                if (params.name.includes('Allocated')) {
                                    percent = ((totalAllocatedMemoryGb / totalCapacityMemoryGb) * 100).toFixed(1);
                                } else if (params.name.includes('Free')) {
                                    percent = ((totalFreeMemoryGb / totalCapacityMemoryGb) * 100).toFixed(1);
                                }
                            }

                            if (percent !== '') {
                                return `${params.name}: ${value} ${unit} (${percent}%)`;
                            } else {
                                return `${params.name}: ${value} ${unit}`;
                            }
                        }
                    },
                    series: [{
                        type: 'sunburst',
                        radius: [0, '90%'],
                        itemStyle: {
                            borderRadius: 10,
                            borderColor: 'var(--bg-card)',
                            borderWidth: 2,
                        },
                        data: [{
                                name: 'Resources',
                                itemStyle: {
                                    color: colorScheme.resourceOcpus
                                },
                                children: [{
                                        name: 'OCPUs',
                                        itemStyle: { color: colorScheme.allocatedOcpus },
                                        children: [
                                            { name: 'Allocated OCPUs', value: totalAllocatedOcpus, itemStyle: { color: '#5470c6' } },
                                            { name: 'Free OCPUs', value: totalFreeOcpus, itemStyle: { color: colorScheme.freeOcpus } }
                                        ]
                                    },
                                    {
                                        name: 'Memory',
                                        itemStyle: { color: colorScheme.freeOcpus }, // Orange
                                        children: [
                                            { name: 'Allocated Memory', value: totalAllocatedMemoryGb, itemStyle: { color: colorScheme.allocatedMemory } },
                                            { name: 'Free Memory', value: totalFreeMemoryGb, itemStyle: { color: colorScheme.freeMemory } }
                                        ]
                                }]
                        }],
                        label: {
                            rotate: 'radial',
                            formatter: function (param) {
                                // 修改标签显示文本
                                if (param.name === "Allocated OCPUs") {
                                    return "Allocated";
                                } else if (param.name === "Free OCPUs") {
                                    return "Free";
                                } else if (param.name === "Allocated Memory") {
                                    return "Allocated";
                                } else if (param.name === "Free Memory") {
                                    return "Free";
                                } else {
                                    // 对于其他文本，保持原样或进行适当截断
                                    return param.name.length > 10 ? param.name.substring(0, 10) + '...' : param.name;
                                }
                            }
                        },
                        levels: [
                            {},
                            {
                                r0: '0%',
                                r: '25%',
                                itemStyle: {
                                    borderWidth: 2
                                },
                                label: {
                                    rotate: 'tangential',
                                    fontSize: 14,
                                    avoidLabelOverlap: true // 在层级中也设置
                                }
                            },
                            {
                                r0: '25%',
                                r: '75%',
                                label: {
                                    rotate: 'tangential',
                                    avoidLabelOverlap: true // 在层级中也设置
                                }
                            },
                            {
                                r0: '75%',
                                r: '90%',
                                label: {
                                    rotate: 'tangential',
                                },
                                itemStyle: {
                                    borderWidth: 1
                                }
                            }]
                    }]
                };
                // --- End of 4. Configure Resource Utilization Doughnut Chart (using ECharts) ---

                // --- 5. Configure Instance Distribution Bar Chart (using ECharts) ---
                // 预处理数据，添加颜色信息
                const processedInstanceData = JSON.parse(JSON.stringify(instanceDistributionData));

                // 为根节点设置颜色
                processedInstanceData.itemStyle = processedInstanceData.itemStyle || {};
                processedInstanceData.itemStyle.color = colorScheme.resourceRoot;

                // 为租户层级设置颜色
                processedInstanceData.children.forEach((tenancy, index) => {
                    tenancy.itemStyle = tenancy.itemStyle || {};
                    tenancy.itemStyle.color = colorScheme.tenancyColors[index % colorScheme.tenancyColors.length];

                    // 为子层级设置颜色
                    tenancy.children.forEach(child => {
                        child.itemStyle = child.itemStyle || {};
                        if (child.name === 'Allocated OCPUs') {
                            child.itemStyle.color = colorScheme.ocpusColor;
                        } else if (child.name === 'Allocated Memory (GB)') {
                            child.itemStyle.color = colorScheme.memoryColor;
                        }
                    });
                });

                const instanceOption = {
                    // title: {
                    //     text: 'Instance Distribution by Tenancy',
                    //     left: 'center',
                    //     textStyle: {
                    //         fontSize: 16,
                    //         fontWeight: 'bold'
                    //     }
                    // },
                    tooltip: {
                        trigger: 'item',
                        formatter: function (params) {
                            const data = params.data;

                            // Root level
                            if (params.name === 'Resources') {
                                return `
                                <b>Resources</b><br/>
                                Total Allocated OCPUs: ${totalAllocatedOcpus}<br/>
                                Total Allocated Memory: ${totalAllocatedMemoryGb} GB
                                `;
                            }

                            // Tenancy level (level 2)
                            if (data.hasOwnProperty('allocated_ocpus')) {
                                return `
                                    <div style="font-weight:bold; margin-bottom:8px;">${data.name}</div>
                                    <div>Allocated OCPUs: ${data.allocated_ocpus} (${data.allocated_ocpus_percentage}%)</div>
                                    <div>Allocated Memory: ${data.allocated_memory} GB (${data.allocated_memory_percentage}%)</div>
                                    `;
                            }

                            // Resource type level (level 3)
                            return `
                                    <div style="font-weight:bold; margin-bottom:8px;">${data.tenancy}</div>
                                    <div>${data.name}: ${data.value} (${data.percentage}%)</div>
                                    `;
                        }
                    },
                    series: [{
                        type: 'sunburst',
                        radius: [0, '90%'],
                        data: [processedInstanceData],
                        itemStyle: {
                            borderRadius: 10,
                            borderColor: 'var(--bg-card)',
                            borderWidth: 2,
                            color: function(params) {
                                const data = params.data;
                                // 直接使用数据中预设的颜色
                                return data.itemStyle?.color || 'rgba(255, 255, 255, 0.2)';
                            }
                        },
                        label: {
                            rotate: 'radial',
                            formatter: function (param) {
                                // 修改标签显示文本
                                if (param.name === "Allocated OCPUs") {
                                    return "OCPUs";
                                } else if (param.name === "Allocated Memory (GB)") {
                                    return "Memory";
                                } else {
                                    // 对于其他文本，保持原样或进行适当截断
                                    return param.name.length > 10 ? param.name.substring(0, 10) + '...' : param.name;
                                }
                            },
                            show: function(param) {
                                return param.treeDepth <= 1; // 仅显示 Resources 和 Tenancy 层
                            },
                            avoidLabelOverlap: true,
                        },
                        emphasis: {
                            label: {
                                show: true, // 点击或高亮时显示
                                rotate: 'tangential',
                            }
                        },
                        levels: [
                            {},
                            {
                                r0: '0%',
                                r: '25%',
                                itemStyle: {
                                    borderWidth: 2
                                },
                                label: {
                                    rotate: 'tangential',
                                    fontSize: 14,
                                    avoidLabelOverlap: true // 在层级中也设置
                                }
                            },
                            {
                                r0: '25%',
                                r: '75%',
                                itemStyle: {
                                    borderWidth: 1
                                },
                                label: {
                                    avoidLabelOverlap: true // 在层级中也设置
                                }
                            },
                            {
                                r0: '75%',
                                r: '90%',
                                itemStyle: {
                                    borderWidth: 1
                                },
                                label: {
                                    show: false,
                                    rotate: 'tangential',
                                }
                            }
                        ]
                    }]
                };
                // --- End of 5. Configure Instance Distribution Bar Chart (using ECharts) ---

                // --- 6. Set theme adaptation ---
                const setChartBackground = () => {
                    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : '';
                    const bgColor = theme === 'dark' ? 'var(--bg-card)' : '';

                    resourceOption.backgroundColor = bgColor;
                    instanceOption.backgroundColor = bgColor;

                    // 如果图表实例已存在，则更新
                    if (resourceChart) {
                        resourceChart.setOption({
                            backgroundColor: bgColor
                        });
                        // 添加这一行：重新调整图表大小
                        resourceChart.resize();
                    }
                    if (instanceChart) {
                        instanceChart.setOption({
                            backgroundColor: bgColor
                        });
                        // 添加这一行：重新调整图表大小
                        instanceChart.resize();
                    }
                };

                // 初始化设置
                setChartBackground();

                // 监听主题变化
                const observer = new MutationObserver((mutations) => {
                    mutations.forEach((mutation) => {
                        if (mutation.attributeName === 'data-theme') {
                            setChartBackground();
                        }
                    });
                });

                observer.observe(document.documentElement, {
                    attributes: true
                });

                // 监听窗口大小变化 - 使用防抖优化性能
                let resizeTimer;
                window.addEventListener('resize', () => {
                    clearTimeout(resizeTimer);
                    resizeTimer = setTimeout(() => {
                        // 重新设置背景色并调整图表大小
                        setChartBackground();

                        // 确保图表重新渲染
                        if (resourceChart) {
                            resourceChart.resize();
                        }
                        if (instanceChart) {
                            instanceChart.resize();
                        }
                    }, 250);
                });
                // --- End of 6. Set theme adaptation ---

                // --- 7. Render Charts using ECharts ---
                resourceChart.setOption(resourceOption);
                instanceChart.setOption(instanceOption);

                console.log("[JS] [ECharts] Resource Utilization Doughnut chart rendered.");
                console.log("[JS] [ECharts] Instance Distribution Bar chart rendered.");
                console.log("[JS] [ECharts] Dashboard graphs initialized successfully.");
                // --- End of 7. Render Charts using ECharts ---

                // --- 8. Optional: Handle Window Resize ---
                window.addEventListener('resize', function() {
                    if (resourceChart) {
                        resourceChart.resize();
                    }
                    if (instanceChart) {
                        instanceChart.resize();
                    }
                });
                // --- End of 8. Optional: Handle Window Resize ---

            } catch (error) {
                console.error("[JS] [ECharts] Error initializing dashboard graphs:", error);
            }
        }
        // --- End of ECharts Graph Initialization ---

        // --- Theme Toggle ---
        const themeToggle = document.getElementById('themeToggle');
        const themeIcon = themeToggle.querySelector('i');

        // Check for saved theme or default to dark
        const currentTheme = localStorage.getItem('theme') || 'dark';
        document.documentElement.setAttribute('data-theme', currentTheme);
        themeIcon.className = currentTheme === 'dark' ? 'fas fa-sun' : 'fas fa-moon';

        themeToggle.addEventListener('click', () => {
            const newTheme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
            document.documentElement.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            themeIcon.className = newTheme === 'dark' ? 'fas fa-sun' : 'fas fa-moon';
        });

        // --- Search Functionality for Instances Tab ---
        function setupSearch(searchId, clearId) {
            const searchInput = document.getElementById(searchId);
            const clearButton = document.getElementById(clearId);
            // Scope the table selection to the instances tab to avoid conflicts
            const table = document.querySelector('#instances #instanceTable');

            if (!searchInput || !clearButton || !table) {
                console.warn(`Search elements or table not found for IDs: searchId=${searchId}, clearId=${clearId}`);
                return;
            }

            searchInput.addEventListener('input', function() {
                const searchTerm = this.value.toLowerCase().trim();

                // Show/hide clear button
                if (searchTerm) {
                    clearButton.classList.add('show');
                } else {
                    clearButton.classList.remove('show');
                }

                // Filter rows
                const rows = table.querySelectorAll('tbody tr');
                if (searchTerm === '') {
                    rows.forEach(row => row.classList.remove('hidden'));
                    updateVisibleCount(0); // Reset visible count
                    return;
                }
                let visibleCount = 0;
                rows.forEach(row => {
                    const text = row.textContent.toLowerCase();
                    if (text.includes(searchTerm)) {
                        row.classList.remove('hidden');
                        visibleCount++;
                    } else {
                        row.classList.add('hidden');
                    }
                });
                updateVisibleCount(visibleCount);
            });

            clearButton.addEventListener('click', function() {
                searchInput.value = '';
                clearButton.classList.remove('show');
                const rows = table.querySelectorAll('tbody tr');
                rows.forEach(row => row.classList.remove('hidden'));
                updateVisibleCount(0); // Reset visible count
            });
        }

        // --- Search Functionality for Links Tab ---
        function setupLinksSearch() {
            const searchInput = document.getElementById('search-links');
            const clearButton = document.getElementById('clear-links');
            const table = document.querySelector('#links table');

            if (!searchInput || !clearButton || !table) {
                console.warn(`Links search elements or table not found.`);
                return;
            }

            searchInput.addEventListener('input', function() {
                const searchTerm = this.value.toLowerCase().trim();

                if (searchTerm) {
                    clearButton.classList.add('show');
                } else {
                    clearButton.classList.remove('show');
                }

                const rows = table.querySelectorAll('tbody tr');
                if (searchTerm === '') {
                    rows.forEach(row => row.classList.remove('hidden'));
                    return;
                }
                rows.forEach(row => {
                    const text = row.textContent.toLowerCase();
                    if (text.includes(searchTerm)) {
                        row.classList.remove('hidden');
                    } else {
                        row.classList.add('hidden');
                    }
                });
            });

            clearButton.addEventListener('click', function() {
                searchInput.value = '';
                clearButton.classList.remove('show');
                const rows = table.querySelectorAll('tbody tr');
                rows.forEach(row => row.classList.remove('hidden'));
            });
        }

        // --- Setup searches and other initializations after DOM is loaded ---
        document.addEventListener('DOMContentLoaded', function() {
            // setupSearch('tab2-search', 'clear-instances');
            // setupLinksSearch();
            // Future: Setup search for other tabs if needed
            // --- Initialize graphs if the default active tab is 'dashboard' ---
            // Although the click handler should catch it, this is a safety net
            if (document.getElementById('dashboard')?.classList.contains('active') && !dashboardGraphsInitialized) {
                console.log("[JS] Initializing Dashboard graphs on DOMContentLoaded...");
                initializeDashboardGraphs();
                dashboardGraphsInitialized = true;
            }
        });
        // --- End of Setup searches and other initializations after DOM is loaded ---

        // --- Filtering Functions for Instances Tab ---
        document.addEventListener("DOMContentLoaded", function() {
          const searchInput = document.getElementById("tab2-search");
          const clearBtn = document.getElementById("clear-instances");
          const rows = document.querySelectorAll("#instanceTable .instance-row");
          const visibleCountSpan = document.getElementById("tab2-visible-count");

          function updateSearch() {
            const query = searchInput.value.toLowerCase();
            let visibleCount = 0;
            rows.forEach(row => {
              const text = row.innerText.toLowerCase();
              if (text.includes(query)) {
                row.classList.remove("hidden");
                visibleCount++;
              } else {
                row.classList.add("hidden");
              }
            });
            visibleCountSpan.textContent = visibleCount;
            clearBtn.style.display = query ? "block" : "none";
          }

          searchInput.addEventListener("input", updateSearch);

          clearBtn.addEventListener("click", () => {
            searchInput.value = "";
            updateSearch();
          });
        });

        function filterTab2Instances(value, type) {
            tab2Filters[type] = value;

            // Update active button for state filters only
            if (type === 'state') {
                document.querySelectorAll('.filter-btn[data-filter-type="state"]').forEach(btn => {
                    btn.classList.remove('active');
                });
                event.target.classList.add('active');
            }

            applyTab2Filters();
        }

        function applyTab2Filters() {
            const tenancyFilter = document.getElementById('tab2-tenancy-filter');
            const compartmentFilter = document.getElementById('tab2-compartment-filter');
            const faultDomainFilter = document.getElementById('tab2-fault-domain-filter');

            tab2Filters.tenancy = tenancyFilter.value;
            tab2Filters.compartment = compartmentFilter.value;
            tab2Filters.faultDomain = faultDomainFilter.value;

            // If tenancy is selected, filter compartments and fault domains
            if (tab2Filters.tenancy !== 'ALL') {
                filterCompartmentsByTenancy(tab2Filters.tenancy);
                filterFaultDomainsByTenancy(tab2Filters.tenancy);
            } else {
                // Show all compartments and fault domains
                showAllOptions('tab2-compartment-filter');
                showAllOptions('tab2-fault-domain-filter');
            }

            applyAllTab2Filters();
        }

        function filterCompartmentsByTenancy(selectedTenancy) {
            filterDropdownByTenancy('tab2-compartment-filter', selectedTenancy);
        }

        function filterFaultDomainsByTenancy(selectedTenancy) {
            filterDropdownByTenancy('tab2-fault-domain-filter', selectedTenancy);
        }

        function filterDropdownByTenancy(dropdownId, selectedTenancy) {
            const dropdown = document.getElementById(dropdownId);
            const options = dropdown.querySelectorAll('option, optgroup');

            options.forEach(option => {
                if (option.tagName === 'OPTGROUP') {
                    // For optgroup, check if it matches the tenancy
                    if (option.label === selectedTenancy) {
                        option.style.display = '';
                        // Show all options within this group
                        const groupOptions = option.querySelectorAll('option');
                        groupOptions.forEach(opt => opt.style.display = '');
                    } else {
                        option.style.display = 'none';
                    }
                } else if (option.tagName === 'OPTION' && option.value !== 'ALL') {
                    // For individual options, check if they belong to the selected tenancy
                    const tenancyAttr = option.getAttribute('data-tenancy');
                    if (tenancyAttr === selectedTenancy) {
                        option.style.display = '';
                    } else {
                        option.style.display = 'none';
                    }
                }
            });
        }

        function showAllOptions(dropdownId) {
            const options = document.getElementById(dropdownId).querySelectorAll('option, optgroup');
            options.forEach(option => {
                option.style.display = '';
            });
        }

        function resetTab2Filters() {
            // Reset filter values
            tab2Filters = {
                state: 'ALL',
                tenancy: 'ALL',
                compartment: 'ALL',
                faultDomain: 'ALL',
                search: ''
            };

            // Reset UI elements
            document.getElementById('tab2-search').value = '';
            document.getElementById('tab2-tenancy-filter').value = 'ALL';
            document.getElementById('tab2-compartment-filter').value = 'ALL';
            document.getElementById('tab2-fault-domain-filter').value = 'ALL';

            // Show all compartments and fault domains again
            showAllOptions('tab2-compartment-filter');
            showAllOptions('tab2-fault-domain-filter');

            // Reset state filter buttons
            document.querySelectorAll('.filter-btn[data-filter-type="state"]').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector('.filter-btn[data-filter-type="state"]').classList.add('active');

            // Clear search input clear button
            document.getElementById('clear-instances').classList.remove('show');

            applyAllTab2Filters();
            updateVisibleCount(0); // Reset visible count
        }

        function applyAllTab2Filters() {
            const rows = document.querySelectorAll('#instances .instance-row'); // Scope to instances tab
            let visibleCount = 0;

            rows.forEach(row => {
                const state = row.getAttribute('data-state');
                const tenancy = row.getAttribute('data-tenancy');
                const compartment = row.getAttribute('data-compartment');
                const faultDomain = row.getAttribute('data-fault-domain');
                const searchText = row.textContent.toLowerCase();

                // Check all filters
                const stateMatch = (tab2Filters.state === 'ALL' || state === tab2Filters.state);
                const tenancyMatch = (tab2Filters.tenancy === 'ALL' || tenancy === tab2Filters.tenancy);
                const compartmentMatch = (tab2Filters.compartment === 'ALL' || compartment === tab2Filters.compartment);
                const faultDomainMatch = (tab2Filters.faultDomain === 'ALL' || faultDomain === tab2Filters.faultDomain);
                const searchMatch = (tab2Filters.search === '' || searchText.includes(tab2Filters.search));

                if (stateMatch && tenancyMatch && compartmentMatch && faultDomainMatch && searchMatch) {
                    row.classList.remove('hidden');
                    visibleCount++;
                } else {
                    row.classList.add('hidden');
                }
            });

            // Update ONLY the visible counter - other counters should remain unchanged
            updateVisibleCount(visibleCount);
        }

        function updateVisibleCount(count) {
            const visibleCountElement = document.getElementById('tab2-visible-count');
            if (visibleCountElement) {
                visibleCountElement.textContent = count;
            }
        }

        function setupScrollButtons() {
          const contentArea = document.querySelector('.content-area');
          const backToTopBtn = document.getElementById('backToTop');
          const scrollToBottomBtn = document.getElementById('scrollToBottom');

          // ✅ 判断当前滚动目标
          const isContentScrollable = contentArea && contentArea.scrollHeight > contentArea.clientHeight;
          const scrollTarget = isContentScrollable ? contentArea : window;

          function handleScroll() {
            const scrollTop = isContentScrollable ? contentArea.scrollTop : window.scrollY;
            const scrollHeight = isContentScrollable
              ? contentArea.scrollHeight
              : document.documentElement.scrollHeight;
            const clientHeight = isContentScrollable ? contentArea.clientHeight : window.innerHeight;

            backToTopBtn.style.display = scrollTop > 100 ? 'flex' : 'none';
            scrollToBottomBtn.style.display =
              (scrollTop + clientHeight < scrollHeight - 100) ? 'flex' : 'none';
          }

          scrollTarget.removeEventListener('scroll', handleScroll);
          scrollTarget.addEventListener('scroll', handleScroll);
          handleScroll();

          backToTopBtn.onclick = () => {
            if (isContentScrollable) {
              contentArea.scrollTo({ top: 0, behavior: 'smooth' });
            } else {
              window.scrollTo({ top: 0, behavior: 'smooth' });
            }
          };

          scrollToBottomBtn.onclick = () => {
            if (isContentScrollable) {
              contentArea.scrollTo({ top: contentArea.scrollHeight, behavior: 'smooth' });
            } else {
              window.scrollTo({ top: document.documentElement.scrollHeight, behavior: 'smooth' });
            }
          };
        }

        // --- Initialize Scroll Buttons After DOM Loaded ---
        document.addEventListener('DOMContentLoaded', () => {
            // 初次绑定
            setupScrollButtons();

            // 延迟重新检查一次（等待 Dashboard 图表或表格渲染完）
            setTimeout(setupScrollButtons, 500);

            // 当内容高度变化（例如图表加载完成）时自动重新绑定滚动监听
            const contentArea = document.querySelector('.content-area');
            if (contentArea) {
              const observer = new ResizeObserver(() => setupScrollButtons());
              observer.observe(contentArea);
            }
        })
    </script>
</body>
</html>